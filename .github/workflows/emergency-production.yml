name: ğŸš¨ Emergency Production Deploy

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Emergency deployment reason'
        required: true
        type: string
      
env:
  NODE_VERSION: '18'

jobs:
  emergency-deploy:
    name: ğŸš¨ Emergency Deployment
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: ğŸ“¦ Install wrangler
        run: npm install -g wrangler

      - name: âš¡ Emergency Worker Deploy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        run: |
          cd src
          wrangler deploy --env production --force

      - name: ğŸ“¢ Emergency Notification
        run: |
          echo "ğŸš¨ Emergency deployment completed"
          echo "ğŸ“ Reason: ${{ github.event.inputs.reason }}"
          echo "â° Time: $(date)"
          echo "ğŸŒ Status: https://wired-chaos-worker.wiredchaos.workers.dev/health"