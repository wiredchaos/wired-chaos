#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

const OUTPUT_DIR = process.argv[2] || path.join('docs', 'codex-release');

const ensureDir = (dir) => {
  fs.mkdirSync(dir, { recursive: true });
};

const writeFile = (filePath, content) => {
  fs.writeFileSync(filePath, content.replace(/\s+$/u, '') + '\n');
  console.log(`✅ Generated ${filePath}`);
};

ensureDir(OUTPUT_DIR);

const year = new Date().getFullYear();

const prBundle = [
  '# WIRED CHAOS CODEX — Press Bundle',
  '',
  '**Tagline:** Where AI feeds itself and learns from the ledger.',
  '',
  '## Executive Summary',
  'WIRED CHAOS CODEX introduces a federated Model Arena that fuses GPT-5, Gemini 2.5, Claude 3, Perplexity, Bing, and h2oGPT into a dual-engine reasoning stack. The system delivers adaptive routing, ensemble consensus, and air-gapped fallbacks so product teams can orchestrate autonomous intelligence with Web3-native guardrails.',
  '',
  '## Headline Angles',
  '1. **WIRED CHAOS launches CODEX — an AI arena where models debate and consensus evolves in real time.**',
  '2. **From feeds to feelings to facts — the WIRED CHAOS Model Arena unifies GPT-5, Gemini, Claude & Perplexity.**',
  '3. **A low-risk Web3 AI stack for the post-API economy — self-hosted, encrypted, and agentic.**',
  '',
  '## Feature Matrix',
  '| Capability | Description | Components |',
  '| --- | --- | --- |',
  '| Dual-Engine Reasoning | Quota-aware routing between GPT-5 (deep logic) and Gemini 2.5 (multimodal) | GPT-5, Gemini 2.5 |',
  '| Ensemble Consensus | Claude 3 moderation plus Perplexity and Bing fact checks before publishing | Claude 3, Perplexity, Bing |',
  '| Offline Fallback | Local inference mode when external APIs fail | h2oGPT |',
  '| Developer Layer | Chaos SDK, GitHub Copilot tasks, VS Code automations | Copilot, VS Code |',
  '| Web3 Autonomy | Walletless auth and read-only chain observability | Thirdweb, dRPC |',
  '| Automation Reactor | FreshRSS → n8n → social distribution | FreshRSS, n8n |',
  '| Vaulted Security | Zero-knowledge storage for keys, mnemonics, and agent secrets | Bitwarden |',
  '| Contract Transparency | Agent-triggered decompilation for on-chain contracts | SuiGPT MAD |',
  '',
  '## Architecture Snapshot',
  '- Model Arena Router: arena/ coordinates task intents, consensus voting, and failover logic.',
  '- Chaos SDK: sdk/ exposes TypeScript and Python bindings with quota-aware retries and usage telemetry.',
  '- AgentKit Bridge: agentkit/ links Gemini streaming to GPT-5 long-form planning and Claude tone calibration.',
  '- Security Baseline: security/ stores automation manifests for Bitwarden, FreshRSS, n8n, and dRPC provisioning.',
  '- Docs: docs/ compiles the press bundle, whitepaper, and investor deck.',
  '',
  '## Security Baseline Highlights',
  '- FreshRSS self-hosted feed ingestion for provenance.',
  '- n8n local workflow runner to avoid untrusted SaaS chains.',
  '- Bitwarden vault for AES-256 encrypted secret storage.',
  '- dRPC read-only chain access to eliminate write privileges.',
  '- Thirdweb walletless authentication for safer onboarding.',
  '- SuiGPT MAD contract inspection before any Web3 execution.',
  '- h2oGPT air-gapped agent for sensitive operations.',
  '',
  '## SDK + API Integration Notes',
  '- REST and WebSocket endpoints for GPT-5 / Gemini requests with fallback tokens.',
  '- Streaming callbacks to Claude for ethical tone scoring prior to publishing.',
  '- Perplexity and Bing search invoked through orchestrated research tasks.',
  '- Local adapters for h2oGPT to serve as cold-standby inference.',
  '',
  '## Roadmap',
  `- **Q2 ${year}:** Release Arena governance dashboard with consensus audit trails.`,
  `- **Q3 ${year}:** Ship self-tuning agent recipes and third-party plugin marketplace.`,
  `- **Q4 ${year}:** Introduce automated compliance scanners and red-team sandboxing.`,
  '- **Beyond:** Autonomous infrastructure scaling and self-healing operations.',
  '',
  '## Call to Action',
  '> Developers: git clone https://github.com/wiredchaos/codex',
  '>',
  '> Media: wiredchaos.xyz/codex/press',
  '>',
  '> Community: Tune in via 33.3 FM DOGECHAIN.',
  '>',
  '> Investors: invest@wiredchaos.xyz'
].join('\n');

const whitepaper = [
  '---',
  'title: "WIRED CHAOS CODEX Technical Whitepaper"',
  'author: "WIRED CHAOS Engineering Guild"',
  `date: "${year}"`,
  '---',
  '',
  '# 1. Introduction',
  'WIRED CHAOS CODEX is an agentic Model Arena that enables autonomous coordination between large language models, Web3 telemetry, and developer automation. The platform emphasises dual-engine reasoning, verifiable consensus, and a low-risk security posture for the post-API economy.',
  '',
  '# 2. System Overview',
  '- Primary Reasoner: OpenAI GPT-5 for deep planning and reflection.',
  '- Multimodal Specialist: Gemini 2.5 Flash / Pro for image, audio, and code synthesis.',
  '- Ethical Voice: Claude 3 ensures tone, compliance, and narrative balance.',
  '- Research Mesh: Perplexity AI plus Bing Search deliver real-time citations.',
  '- Offline Fallback: h2oGPT runs locally for air-gapped operations.',
  '- Automation Layer: GitHub Copilot + VS Code tasks orchestrate developer workflows.',
  '- Web3 Stack: FreshRSS, n8n, Bitwarden, dRPC, Thirdweb, and SuiGPT MAD uphold the low-risk security baseline.',
  '',
  '# 3. Arena Routing Logic',
  '```',
  'if task.requires_web: bing + perplexity',
  'elif task.requires_multimodal: gemini',
  'elif task.requires_deep_reasoning: gpt5',
  'elif task.requires_tone: claude',
  'else: gpt5',
  '',
  'if api_failure: h2oGPT',
  'result = consensus_vote(models)',
  'publish(result)',
  '```',
  '',
  '# 4. Repository Layout',
  '- sdk/ — TypeScript and Python bindings, rate limiting, and usage analytics.',
  '- agentkit/ — Gemini ↔ GPT bridge, Claude moderation hooks, streaming transport.',
  '- arena/ — Task classifier, router, consensus orchestrator, and fallback policies.',
  '- security/ — Infrastructure-as-code for Bitwarden, FreshRSS, n8n, dRPC, Thirdweb, SuiGPT MAD.',
  '- docs/ — Press assets, whitepaper source, and investor communications.',
  '',
  '# 5. Security Baseline',
  '| Control | Rationale |',
  '| --- | --- |',
  '| FreshRSS | Own the ingestion pipeline and maintain provenance of sources. |',
  '| n8n | Run orchestration locally, enforce deterministic workflows. |',
  '| Bitwarden | Zero-knowledge vault for API keys, mnemonics, and credentials. |',
  '| dRPC | Read-only chain access to prevent unauthorized writes. |',
  '| Thirdweb | Walletless auth for safe onboarding in dev/test environments. |',
  '| SuiGPT MAD | Local contract decompiler to inspect smart contracts before execution. |',
  '| h2oGPT | Air-gapped fallback when external APIs are unavailable or untrusted. |',
  '',
  '# 6. SDK & API Integration',
  '- Multi-tenant API keys with quota awareness and circuit breakers.',
  '- Event-driven hooks to refresh FreshRSS feeds and trigger n8n tasks.',
  '- Developer CLI for generating API tokens and scaffolding agent recipes.',
  '- Reference implementations for Python, TypeScript, and serverless adapters.',
  '',
  '# 7. Roadmap & Future Work',
  '1. Governance telemetry with consensus heatmaps and arbitration history.',
  '2. Self-tuning prompts sourced from on-chain analytics and user feedback loops.',
  '3. Autonomous deployments that evaluate diffs, open PRs, and push to staging.',
  '4. Infrastructure autonomy with SLO monitoring, self-healing, and safe rollbacks.',
  '',
  '# 8. Contribution Guide',
  '- Fork the repository and create feature branches.',
  '- Run npm run codex:press-kit to regenerate the press bundle locally.',
  '- Submit PRs with design notes and safety considerations.',
  '- Join the community call on 33.3 FM DOGECHAIN for live syncs.',
  '',
  '# 9. Contact',
  '- Developers: @wiredchaos on GitHub.',
  '- Investors: invest@wiredchaos.xyz.',
  '- Media: wiredchaos.xyz/codex/press.'
].join('\n');

const pitchDeck = [
  '---',
  'theme: gaia',
  'paginate: true',
  'backgroundColor: #000000',
  'style: |',
  "  section {",
  "    color: #00FFFF;",
  "    font-family: 'Montserrat', sans-serif;",
  '  }',
  '  h1, h2, h3 {',
  '    color: #FF3131;',
  '  }',
  '  strong {',
  '    color: #39FF14;',
  '  }',
  '---',
  '',
  '# WIRED CHAOS CODEX',
  '## Where AI feeds itself and learns from the ledger.',
  '',
  '---',
  '',
  '## Problem',
  '- AI systems operate in silos.',
  '- Trust, provenance, and compliance are fragile.',
  '- Web3 automation is risky without strong guardrails.',
  '',
  '---',
  '',
  '## Solution',
  '- Model Arena with ensemble consensus.',
  '- Dual-engine routing across GPT-5 and Gemini.',
  '- Low-risk Web3 automation stack.',
  '',
  '---',
  '',
  '## Architecture',
  '- GPT-5 reasoning core.',
  '- Gemini multimodal streaming.',
  '- Claude ethical governor.',
  '- Perplexity + Bing research mesh.',
  '- h2oGPT offline fallback.',
  '',
  '---',
  '',
  '## Security Baseline',
  '- FreshRSS self-hosted feeds.',
  '- n8n workflow automation.',
  '- Bitwarden zero-knowledge vault.',
  '- dRPC + Thirdweb Web3 safe mode.',
  '- SuiGPT MAD contract audits.',
  '',
  '---',
  '',
  '## Developer Stack',
  '- Chaos SDK (TS + Python).',
  '- AgentKit bridging Gemini ↔ GPT.',
  '- VS Code + Copilot automations.',
  '- Consensus Engine with publish hooks.',
  '',
  '---',
  '',
  `## Roadmap ${year}`,
  '- Q2: Governance telemetry.',
  '- Q3: Plugin marketplace.',
  '- Q4: Compliance automation.',
  '- Beyond: Autonomous infrastructure.',
  '',
  '---',
  '',
  '## Call to Action',
  '- Clone → github.com/wiredchaos/codex',
  '- Download Press Kit → wiredchaos.xyz/codex/press',
  '- Tune → 33.3 FM DOGECHAIN',
  '- Contact → invest@wiredchaos.xyz'
].join('\n');

const releasePost = [
  '# WIRED CHAOS CODEX Launch Copy',
  '',
  '## X / Twitter (≤300 characters)',
  'WIRED CHAOS launches CODEX — an arena where GPT-5, Gemini, Claude, Perplexity, and h2oGPT debate every prompt. Dual-engine routing, on-chain consensus, and a low-risk Web3 stack keep builders in control. Clone the repo and join the broadcast on 33.3 FM DOGECHAIN.',
  '',
  '## LinkedIn (≤300 characters)',
  'Introducing WIRED CHAOS CODEX: a model arena where GPT-5, Gemini, Claude, and Perplexity reach consensus with Web3-grade guardrails. Dual-engine reasoning, offline fallback, and a transparent security baseline power the next wave of autonomous teams.',
  '',
  '## WiredChaos.xyz/dev Summary',
  'CODEX unifies GPT-5 deep planning, Gemini multimodal synthesis, Claude tone governance, and Perplexity/Bing research inside a consensus-driven arena. FreshRSS + n8n automation, Bitwarden vaulting, and SuiGPT MAD audits anchor the low-risk Web3 stack. Contributors welcome.'
].join('\n');

const changelog = [
  'version: 3.0.0',
  'codename: "GIGA PROMPT — CODEX PR Push"',
  `released: ${new Date().toISOString()}`,
  'summary:',
  '  - Generated unified press bundle for WIRED CHAOS CODEX launch.',
  '  - Authored technical whitepaper and investor pitch deck sources.',
  '  - Published security baseline and automation roadmap.',
  'assets:',
  '  pr_bundle: docs/codex-release/PR_BUNDLE.md',
  '  whitepaper_pdf: docs/codex-release/WHITEPAPER.pdf',
  '  pitchdeck_pptx: docs/codex-release/PITCHDECK.pptx',
  '  release_post: docs/codex-release/RELEASE_POST.md',
  '  changelog: docs/codex-release/CHANGELOG.yaml'
].join('\n');

writeFile(path.join(OUTPUT_DIR, 'PR_BUNDLE.md'), prBundle);
writeFile(path.join(OUTPUT_DIR, 'WHITEPAPER.md'), whitepaper);
writeFile(path.join(OUTPUT_DIR, 'PITCHDECK.marp.md'), pitchDeck);
writeFile(path.join(OUTPUT_DIR, 'RELEASE_POST.md'), releasePost);
writeFile(path.join(OUTPUT_DIR, 'CHANGELOG.yaml'), changelog);

console.log('\nAll press kit sources generated. Run conversion tooling to produce PDF/PPTX artifacts.');
