<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WIRED CHAOS Notary Verifier</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #000000;
        --cyan: #00ffff;
        --magenta: #ff00ff;
        --red: #ff3131;
        --green: #39ff14;
        --font: 'IBM Plex Mono', monospace;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, rgba(0, 255, 255, 0.2), transparent), var(--bg);
        color: #f5f5f5;
        font-family: var(--font);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }
      .panel {
        width: min(800px, 100%);
        border: 2px solid var(--cyan);
        padding: 2rem;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.85);
        box-shadow: 0 0 24px rgba(0, 255, 255, 0.3);
      }
      h1 {
        margin-top: 0;
        font-size: 1.9rem;
        text-transform: uppercase;
        letter-spacing: 0.2rem;
      }
      .drop-zone {
        border: 2px dashed var(--magenta);
        border-radius: 12px;
        padding: 2rem;
        text-align: center;
        color: #ccc;
        transition: background 0.3s ease, border-color 0.3s ease;
      }
      .drop-zone.dragover {
        background: rgba(255, 0, 255, 0.1);
        border-color: var(--red);
      }
      label {
        display: block;
        margin-top: 1.5rem;
        font-weight: bold;
        color: var(--green);
      }
      textarea, input {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #fff;
        font-family: var(--font);
        padding: 0.75rem;
        margin-top: 0.5rem;
      }
      textarea {
        min-height: 140px;
      }
      button {
        margin-top: 2rem;
        width: 100%;
        padding: 0.9rem;
        font-size: 1rem;
        border-radius: 8px;
        background: linear-gradient(90deg, var(--cyan), var(--magenta));
        border: none;
        color: #000;
        text-transform: uppercase;
        cursor: pointer;
        font-weight: bold;
      }
      pre {
        background: rgba(255, 255, 255, 0.08);
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
        margin-top: 1.5rem;
      }
      .watermark {
        margin-top: 1.5rem;
        font-size: 0.8rem;
        letter-spacing: 0.1rem;
        color: rgba(0, 255, 255, 0.7);
      }
    </style>
  </head>
  <body>
    <main class="panel">
      <h1>WIRED CHAOS DOGE NOTARY VERIFIER</h1>
      <section
        class="drop-zone"
        id="drop-zone"
        tabindex="0"
        aria-label="Drop document to verify"
      >
        <p>Drag & drop document here or click to select.</p>
        <input type="file" id="file-input" style="display: none" />
      </section>
      <label for="attestation">Attestation JSON</label>
      <textarea id="attestation" placeholder="Paste attestation JSON here"></textarea>
      <label for="manifest">Manifest JSON (optional)</label>
      <textarea id="manifest" placeholder="Paste manifest JSON for chunked docs"></textarea>
      <button id="verify-btn">Verify Document</button>
      <pre id="result" aria-live="polite">Waiting for verification...</pre>
      <p class="watermark">WIRED CHAOS • Artist @neurometax • GROK Metadata Integration • Palette #000000 #00FFFF #FF3131 #39FF14 #FF00FF</p>
    </main>
    <script>
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('file-input');
      const verifyBtn = document.getElementById('verify-btn');
      const resultEl = document.getElementById('result');
      let fileBuffer = null;
      let fileName = '';

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      ['dragenter', 'dragover'].forEach((eventName) => {
        dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
      });

      ['dragleave', 'drop'].forEach((eventName) => {
        dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
      });

      dropZone.addEventListener('click', () => fileInput.click());
      dropZone.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          fileInput.click();
        }
      });

      dropZone.addEventListener('drop', handleFiles, false);
      fileInput.addEventListener('change', handleFiles, false);

      function handleFiles(event) {
        const files = event.target.files || event.dataTransfer.files;
        if (!files || !files.length) return;
        const file = files[0];
        fileName = file.name;
        const reader = new FileReader();
        reader.onload = (e) => {
          fileBuffer = new Uint8Array(e.target.result);
          dropZone.querySelector('p').textContent = `Loaded ${file.name} (${file.size} bytes)`;
        };
        reader.readAsArrayBuffer(file);
      }

      async function sha256(buffer) {
        const hash = await crypto.subtle.digest('SHA-256', buffer);
        return Array.from(new Uint8Array(hash))
          .map((b) => b.toString(16).padStart(2, '0'))
          .join('');
      }

      verifyBtn.addEventListener('click', async () => {
        try {
          if (!fileBuffer) {
            throw new Error('Select a file before verifying.');
          }
          const attestationText = document.getElementById('attestation').value.trim();
          if (!attestationText) {
            throw new Error('Paste attestation JSON.');
          }
          const attestation = JSON.parse(attestationText);
          const manifestText = document.getElementById('manifest').value.trim();
          const manifest = manifestText ? JSON.parse(manifestText) : undefined;

          const hash = await sha256(fileBuffer);
          let verified = false;
          let reason = '';

          if (manifest) {
            verified = manifest.doc.doc_hash === hash;
            if (!verified) {
              reason = 'Document hash mismatch against manifest.';
            }
          } else {
            verified = attestation.doc_hash === hash;
            if (!verified) {
              reason = 'Document hash mismatch against attestation.';
            }
          }

          resultEl.textContent = JSON.stringify(
            {
              verified,
              doc_hash: hash,
              mode: manifest ? 'chunked' : 'full',
              reason: reason || undefined,
              attestation,
              manifest,
              ts: new Date().toISOString(),
              watermark: `WIRED CHAOS • ${fileName}`,
            },
            null,
            2
          );
        } catch (error) {
          resultEl.textContent = JSON.stringify(
            {
              verified: false,
              error: error.message || String(error),
              ts: new Date().toISOString(),
            },
            null,
            2
          );
        }
      });
    </script>
  </body>
</html>
