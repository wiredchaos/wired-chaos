name: üìù Content Sync & Social Automation

on:
  push:
    branches: [ main ]
    paths:
      - 'content/**'
      - '.github/workflows/content-sync.yml'
  schedule:
    - cron: '0 9 * * *'  # Daily at 9 AM UTC
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    name: Sync Content & Social
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Notion Content Sync
      run: |
        echo "üîÑ Syncing content from Notion..."
        if [ -n "${{ secrets.NOTION_API_KEY }}" ] && [ -n "${{ secrets.NOTION_DATABASE_ID }}" ]; then
          curl -X POST "https://api.notion.com/v1/databases/${{ secrets.NOTION_DATABASE_ID }}/query" \
            -H "Authorization: Bearer ${{ secrets.NOTION_API_KEY }}" \
            -H "Notion-Version: 2022-06-28" \
            -H "Content-Type: application/json"
          echo "‚úÖ Notion sync completed"
        else
          echo "‚ö†Ô∏è  Notion credentials not configured, skipping sync"
        fi
      continue-on-error: true

    - name: Social Media Automation
      run: |
        echo "üì± Processing social media automation..."
        # Twitter/X posting
        if [ -n "${{ secrets.X_API_KEY }}" ]; then
          echo "Posting to X/Twitter..."
          # Add X API logic here
        else
          echo "‚ö†Ô∏è  X/Twitter credentials not configured, skipping"
        fi
        
        # LinkedIn posting  
        if [ -n "${{ secrets.LINKEDIN_ACCESS_TOKEN }}" ]; then
          echo "Posting to LinkedIn..."
          # Add LinkedIn API logic here
        else
          echo "‚ö†Ô∏è  LinkedIn credentials not configured, skipping"
        fi
        
        # Discord notification
        if [ -n "${{ secrets.DISCORD_WEBHOOK_URL }}" ]; then
          echo "Sending Discord notification..."
          curl -H "Content-Type: application/json" \
            -d '{"content":"üöÄ WIRED CHAOS content updated and synced!"}' \
            "${{ secrets.DISCORD_WEBHOOK_URL }}" || echo "‚ö†Ô∏è  Discord notification failed"
          echo "‚úÖ Discord notification sent"
        else
          echo "‚ö†Ô∏è  Discord webhook not configured, skipping notification"
        fi
      continue-on-error: true

    - name: Update Worker KV
      run: |
        echo "üîÑ Updating Cloudflare Worker KV..."
        # Add KV update logic here
      continue-on-error: true
        
    - name: Completion Status
      run: |
        echo "‚úÖ Content sync and social automation completed!"
        echo "üìä Check your social media platforms for updates"